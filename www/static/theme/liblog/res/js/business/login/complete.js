function reset(){$(".register-item").removeClass("has-error"),$(".alert-danger").remove()}function resetself(e){var r=e.parents(".register-item");r.removeClass("has-error"),r.find(".alert-danger").remove()}function showError(e,r){var a='<small class="help-block alert alert-danger checkright">'+r+"</small>";e.parents(".register-item").addClass("has-error").append(a)}$("#dosave").click(function(){reset();var e=$("#completeForm").validate({error:function(e,r){showError(e,r),e.one("keyup",function(){$(this).parents(".form-group").removeClass("has-error").find(".errorinfo,.glyphicon-remove").addClass("hidden")})},submitBtn:{flag:!0}});if(e){var r={openid:$("#openid").val(),email:$("#email").val(),name:$("#name").val(),nickname:$("#nickname").val(),pic:$("#pic").val(),way:$("#way").val(),createtime:new Date,__CSRF__:$("#csrf").val()};$.ajax({url:"/home/register/adduser",data:r,type:"POST",success:function(e){0===e.errno&&(window.location.href="/login")}})}return!1}),$("#name").on("blur",function(){var e=$(this);if(e.next(".isright").remove(),e.val().length>0){if(resetself(e),e.parents(".register-item").find(".iswrong").remove(),e.next(".isright").remove(),!/^[a-zA-Z0-9_]+$/.test(e.val()))return showError(e,"用户名由数字、字母或下划线组成!"),!1;$.ajax({url:"/register/isexist",data:{name:e.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(r){0!==r.status?(e.parents(".register-item").find(".iswrong").remove(),e.after('<span class="isright" id="basic-addon1">√</span>')):(e.parents(".register-item").addClass("has-error"),e.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$("#email").on("blur",function(){var e=$(this);e.next(".isright").remove();var r=/^\w+@([0-9a-zA-Z]+[.])+[a-z]{2,4}$/,a=e.val();if(""!==a){if(resetself(e),e.parents(".register-item").find(".iswrong").remove(),a&&!r.test(a))return showError(e,"邮箱格式不正确!"),!1;$.ajax({url:"/register/checkemail",data:{email:e.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(r){0!==r.status?(e.parents(".register-item").find(".iswrong").remove(),e.after('<span class="isright" id="basic-addon1">√</span>')):(e.parents(".register-item").addClass("has-error"),e.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$(document).keyup(function(e){13==e.keyCode&&$("#dosave").trigger("click")});