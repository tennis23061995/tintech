function reset(){$(".register-item").removeClass("has-error"),$(".alert-danger").remove()}function resetself(e){var a=e.parents(".register-item");a.removeClass("has-error"),a.find(".alert-danger").remove()}function showError(e,a){var r='<small class="help-block alert alert-danger checkright" style="margin-bottom: 0px; margin-top: 10px;">'+a+"</small>";e.parents(".register-item").addClass("has-error").append(r)}$(function(){var e=function(e){$("#register").click(function(a){var r=e.getValidate();r||($("#notice").addClass("show").removeClass("hide"),setTimeout(function(){$("#notice").addClass("hide").removeClass("show")},2e3),a.preventDefault()),r||($("#captcha").append('<small class="help-block alert alert-danger checkright">请先拖动验证码到相应位置！</small>'),setTimeout(function(){$("#captcha").find(".alert-danger").remove()},2e3),a.preventDefault())}),e.appendTo("#captcha"),e.onReady(function(){$("#wait")[0].className="hide"}),e.onSuccess(function(){var a=e.getValidate();$("#challenge").val(a.geetest_challenge),$("#seccode").val(a.geetest_seccode),$("#validate").val(a.geetest_validate)})};$.ajax({url:"/home/register/geetest?t="+(new Date).getTime(),data:{__CSRF__:G_csrf},type:"get",dataType:"json",success:function(a){initGeetest({gt:a.gt,challenge:a.challenge,product:"float",offline:!a.success},e)}})}),$("#register").click(function(){reset();var e=$("#registerForm").validate({error:function(e,a){showError(e,a)},submitBtn:{flag:!0}});if(e){var a={name:$("#username").val(),password:$("#password").val(),email:$("#email").val(),code:$("#code").val(),geetest_challenge:$("#challenge").val(),geetest_seccode:$("#seccode").val(),geetest_validate:$("#validate").val(),__CSRF__:$("#csrf").val()};""!==$("#challenge").val()&&""!==$("#seccode").val()&&""!==$("#validate").val()&&$.ajax({url:"/register/doregister",data:a,type:"POST",success:function(e){0===e.errno?(alert("注册成功！"),window.location.href="/personal/@"+$("#username").val()):alert(e.errmsg)}})}return!1}),$("#username").on("blur",function(){var e=$(this);if(e.next(".isright").remove(),e.val().length>0){if(resetself(e),e.parents(".register-item").find(".iswrong").remove(),!/^[a-zA-Z0-9_]+$/.test(e.val()))return showError(e,"用户名由数字、字母或下划线组成!"),!1;$.ajax({url:"/register/isexist",data:{name:e.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(a){0!==a.status?(e.parents(".register-item").find(".iswrong").remove(),e.after('<span class="isright" id="basic-addon1">√</span>')):(e.parents(".register-item").addClass("has-error"),e.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$("#email").on("blur",function(){var e=$(this);if(e.next(".isright").remove(),e.val().length>0){if(resetself(e),e.parents(".register-item").find(".iswrong").remove(),!/^\w+@([0-9a-zA-Z]+[.])+[a-z]{2,4}$/.test(e.val()))return showError(e,"邮箱格式不正确!"),!1;$.ajax({url:"/register/checkemail",data:{email:e.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(a){0!==a.status?(e.parents(".register-item").find(".iswrong").remove(),e.after('<span class="isright" id="basic-addon1">√</span>')):(e.parents(".register-item").addClass("has-error"),e.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$(document).keyup(function(e){13==e.keyCode&&$("#register").trigger("click")});