{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\common\\bootstrap\\tags.js"
    ],
    "names": [
        "global",
        "article",
        "tags",
        "parse",
        "parser",
        "nodes",
        "lexer",
        "tok",
        "nextToken",
        "args",
        "parseSignature",
        "advanceAfterBlockEnd",
        "value",
        "CallExtensionAsync",
        "run",
        "context",
        "callback",
        "where",
        "data",
        "think",
        "isEmpty",
        "limit",
        "cid",
        "iscategory",
        "extend",
        "istag",
        "keywords",
        "tagid",
        "toString",
        "rejectnews",
        "console",
        "log",
        "reject",
        "split",
        "length",
        "i",
        "push",
        "parseInt",
        "tid",
        "flag",
        "w",
        "wh",
        "_complex",
        "JSON",
        "type",
        "model",
        "config",
        "order",
        "select",
        "ctx",
        "topic",
        "item",
        "field",
        "join",
        "user",
        "on",
        "topic_item"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\common\\bootstrap\\tags.js",
    "sourcesContent": [
        "/**\r\n置顶文章列表\r\n{% article data = \"topList\",limit= \"6\",flag=\"totop\"%}\r\n站长推荐\r\n{% article data = \"torecomList\",limit= \"6\",flag=\"torecom\"%}\r\n图文推荐\r\n{% article data = \"picrecomList\",limit= \"6\",flag=\"topicrecom\"%}\r\n*/\r\nglobal.article = function(){\r\n    this.tags = ['article'];\r\n    this.parse = function (parser, nodes, lexer) {\n        let tok = parser.nextToken();\n        let args = parser.parseSignature(null, true);\n        parser.advanceAfterBlockEnd(tok.value);\n        return new nodes.CallExtensionAsync(this, 'run', args);\n    };\n    this.run = async function (context, args, callback) {\n        let where = {'ispublished':1};\r\n        let data = think.isEmpty(args.data) ? \"data\" : args.data;\n        let limit = think.isEmpty(args.limit) ? \"10\" : args.limit;\n\r\n\t\t\t\t//分类item\r\n        let cid = think.isEmpty(args.cid) ? {'item':['IN',[-1]]} :{'item':['IN',args.cid]};\r\n        if(args.iscategory){\n            where = think.extend({},where,cid);\n        }\r\n        if(args.istag){\r\n            where = think.extend({},where,{keywords: [\"like\", \"%,\"+args.tagid.toString()+\",%\"]});\r\n        }\r\n        if(!think.isEmpty(args.rejectnews))\r\n        {\r\n          var rejectnews=[];\r\n          console.log(rejectnews);\r\n          var reject=args.rejectnews.split(\",\");\r\n          if(reject.length>0)\r\n          {\r\n            for (var i = 0; i < reject.length; i++) {\r\n              rejectnews.push(parseInt(reject[i]));\r\n            }\r\n          }\r\n          else {\r\n            rejectnews.push(parseInt(reject));\r\n          }\r\n            where = think.extend({},where,{'id':['NOTIN',rejectnews]});\r\n          console.log(rejectnews)\r\n        }\r\n\t\t\t\t//标签tag\r\n        let tid = think.isEmpty(args.tid) ? false :{'tag':['=',args.tid]};\r\n        if(tid){\r\n            where = think.extend({},where,tid);\r\n        }\r\n\t\t\t\t//标签flag\r\n\t\t\t\t// 置顶:flag=\"torecom\",站长推荐:flag=\"torecom\",图文推荐:flag=\"topicrecom\",\n        console.log(\"aaa\"+args.rejectnews)\nif(!think.isEmpty(args.flag))\n{\n  var w=args.flag.split(\",\");\n  if(w.length>1)\n  {\n      let wh=\"{\";\n      for (var i = 0; i < w.length; i++) {\n        wh+='\"'+w[i]+'\":1,'\n      }\n      wh+='\"_logic\": \"or\"}';\n      console.log(wh);\n      let flag ={_complex:JSON.parse(wh)}\r\n      if(flag){\r\n          where = think.extend({},where,flag);\r\n      }\n  }\r\nelse {\n  where = think.extend({},where,{[args.flag]: 1});\n}\r\n}\r\n\r\n        // order by\r\n        let type='flag_a DESC,totop DESC,torecom DESC,createtime DESC';\r\n        if(!think.isEmpty(args.type)){\n            if(args.type==\"hot\"){\n              type=\"view DESC\"\n            }\r\n        }\n\r\n        let article = await think.model('article', think.config(\"db\")).where(where).limit(limit).order(type).select();\r\n\r\n        context.ctx[data] = article;\r\n        return callback(null, '');\n    }\n}\r\n\r\n/**\r\n8条最新主题帖\r\n{% topic data = \"topicList\",limit= \"8\"%}\r\n\r\n8条最热题帖\r\n{% topic data = \"topicList\",limit= \"8\",type=\"hot\" %}\r\n\r\n*/\r\n\r\n\r\nglobal.topic = function(){\r\n    this.tags = ['topic'];\r\n    this.parse = function (parser, nodes, lexer) {\r\n        let tok = parser.nextToken();\r\n        let args = parser.parseSignature(null, true);\r\n        parser.advanceAfterBlockEnd(tok.value);\r\n        return new nodes.CallExtensionAsync(this, 'run', args);\r\n    };\r\n    this.run = async function (context, args, callback) {\r\n        let where = {};\r\n        let data = think.isEmpty(args.data) ? \"data\" : args.data;\r\n        let limit = think.isEmpty(args.limit) ? \"10\" : args.limit;\r\n\r\n\t\t\t\t//主题分类item\r\n        let item = think.isEmpty(args.item) ? false :{'item':['=',args.item]};\r\n        if(item){\r\n            where = think.extend({},where,item);\r\n        }\r\n\r\n        // order by\r\n        let type='mytime DESC';\r\n        if(!think.isEmpty(args.type)){\r\n            if(args.type==\"hot\"){\r\n              type=\"view DESC\"\r\n            }\r\n        }\r\n\r\n        let topic = await think.model('topic', think.config(\"db\")).field(\"*,li_topic.id as tid,li_topic.createtime as mytime\").join({\r\n             user: {on: \"author,name\"},\r\n             topic_item:{on:\"item,name\"}\r\n         }).where(where).limit(limit).order(type).select();\r\n        //\r\n\r\n        context.ctx[data] = topic;\r\n        return callback(null, '');\r\n    }\r\n}\r\n"
    ]
}