{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\personal\\controller\\index.js"
    ],
    "names": [
        "indexAction",
        "assign",
        "session",
        "uinfo",
        "get",
        "uname",
        "isself",
        "isselftag",
        "think",
        "isEmpty",
        "islogin",
        "model",
        "getMytopic",
        "author",
        "topicList",
        "findAll",
        "replyList",
        "topiccomment",
        "i",
        "length",
        "topic",
        "comment",
        "findOne",
        "id",
        "tid",
        "top",
        "name",
        "acc",
        "JSON",
        "parse",
        "push",
        "console",
        "log",
        "replyListArticle",
        "articlecomment",
        "article",
        "art",
        "getMycollect",
        "type",
        "collectList",
        "collectListArticle",
        "userinfo",
        "displayView",
        "settingAction",
        "savecollectAction",
        "post",
        "data",
        "mycreatetime",
        "datetime",
        "deleteRecord",
        "cid",
        "rs",
        "decrepoint",
        "points",
        "success",
        "status",
        "msg",
        "createtime",
        "addRecord",
        "config"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\personal\\controller\\index.js",
    "sourcesContent": [
        "'use strict';\r\n\r\nimport Base from './base.js';\r\nexport default class extends Base {\r\n  /**\r\n   * index action\r\n   * @return {Promise} []\r\n   */\r\n  async indexAction(){\r\n    this.assign(\"title\",\"Trang cá nhân\");\r\n    let uinfo=await this.session('uInfo');\r\n    let uname=await this.get('uname');\r\n    let isself,isselftag;\r\n    if(!think.isEmpty(uname)){\r\n      // 是否登陆\r\n      let islogin=(!think.isEmpty(uinfo))?1:0;\r\n      // if(!think.isEmpty(uinfo)){\r\n\r\n      //是否本人\r\n      // if(!think.isEmpty(uinfo)){\r\n      //   //登陆\r\n      //   if(uinfo.name===uname){\r\n      //     isselftag=\"Chủ đề\";\r\n      //     isself=1;\r\n      //   }else{\r\n      //     isselftag=\"Ta的\";\r\n      //     isself=0;\r\n      //   }\r\n      // }else {\r\n      //   // 未登录\r\n      //   isselftag=\"Ta的\";\r\n      //   isself=0;\r\n      // }\r\n      this.assign(\"islogin\",islogin);\r\n      // this.assign(\"isself\",isself);\r\n      // this.assign(\"isselftag\",isselftag);\r\n\r\n      //我的话题\r\n      let topicList=await this.model('personal').getMytopic({author:uname});\r\n      this.assign(\"topicList\",topicList);\r\n\r\n      //我的回复\r\n      let replyList=await this.model('personal').findAll('topic_comment',{author:uname});\r\n      var topiccomment={topiccomment:[]};\r\n      for(var i=0;i<replyList.length;i++)\r\n      {\r\n        var topic={};\r\n        topic.comment=replyList[i].comment;\r\n        var top=await this.model('personal').findOne(\"topic\",{id:replyList[i].tid});\r\n        var acc=await this.model('personal').findOne(\"user\",{name:replyList[i].author});\r\n        if(!think.isEmpty(top))\r\n        {\r\n          topic.topic=JSON.parse(JSON.stringify(top));\r\n        }\r\n        if(!think.isEmpty(acc))\r\n        {\r\n          topic.acc=JSON.parse(JSON.stringify(acc));\r\n        }\r\n        topiccomment.topiccomment.push(topic)\r\n      }\r\n      console.log(topiccomment);\r\n      this.assign(\"replyList\",topiccomment);\r\n\r\n      let replyListArticle=await this.model('personal').findAll('article_comment',{author:uname});\r\n      var articlecomment={articlecomment:[]};\r\n      for(var i=0;i<replyListArticle.length;i++)\r\n      {\r\n        var article={};\r\n        article.comment=replyListArticle[i].comment;\r\n        var art=await this.model('personal').findOne(\"article\",{id:replyListArticle[i].tid});\r\n        var acc=await this.model('personal').findOne(\"user\",{name:replyListArticle[i].author});\r\n        if(!think.isEmpty(art))\r\n        {\r\n          article.article=JSON.parse(JSON.stringify(art));\r\n        }\r\n        if(!think.isEmpty(acc))\r\n        {\r\n          article.acc=JSON.parse(JSON.stringify(acc));\r\n        }\r\n        articlecomment.articlecomment.push(article)\r\n      }\r\n      console.log(replyListArticle)\r\n      this.assign(\"replyListArticle\",articlecomment);\r\n      //我的收藏\r\n      let collectList=await this.model('personal').getMycollect({author:uname,type:\"topic\"});\r\n      this.assign(\"collectList\",collectList);\r\n      let collectListArticle=await this.model('personal').getMycollect({author:uname,type:\"article\"});\r\n      this.assign(\"collectListArticle\",collectListArticle);\r\n\r\n      let userinfo=await this.model('personal').findAll('user',{name:uname});\r\n      if(!think.isEmpty(userinfo)){\r\n        //他人的个人中心基本信息\r\n        this.assign(\"userinfo\",userinfo[0]);\r\n        return this.displayView(\"index_index\");\r\n\r\n      }else{\r\n        return this.displayView(\"../common/error_404\");\r\n      }\r\n    }else{\r\n      return this.displayView(\"../common/error_404\");\r\n    }\r\n\r\n  }\r\n  async settingAction(){\r\n    return this.displayView(\"index_setting\");\r\n  }\r\n\r\n  //收藏/取消收藏接口\r\n  async savecollectAction(){\r\n    let data=await this.post();\r\n    let mycreatetime=think.datetime(this.post(\"createtime\"));\r\n    if(!think.isEmpty(this.post(\"cid\"))){\r\n      //已收藏\r\n      let rs=await this.model(\"personal\").deleteRecord(\"user_collect\",{id:data.cid});\r\n      let points=await this.model(\"personal\").decrepoint({name:data.author},1);\r\n      if(rs) return this.success({status:0,msg:\"取消收藏成功！\",cid:data.cid});\r\n    }else {\r\n      //未收藏\r\n      data.createtime=mycreatetime;\r\n      let rs=await this.model(\"personal\").addRecord(\"user_collect\",data);\r\n      let points=await this.model(\"personal\").decrepoint({name:data.author},this.config('point.addcollect'));\r\n      if(rs) return this.success({status:1,msg:\"收藏成功！\",cid:rs});\r\n    }\r\n  }\r\n}\r\n"
    ]
}