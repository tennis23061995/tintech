{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\topic\\controller\\index.js"
    ],
    "names": [
        "indexAction",
        "model",
        "findAll",
        "parentid",
        "lstparentmenu",
        "navList",
        "menu",
        "i",
        "length",
        "parseInt",
        "id",
        "submenu",
        "submenusid",
        "j",
        "push",
        "parentmenu",
        "JSON",
        "parse",
        "submenus",
        "assign",
        "displayView",
        "categoryAction",
        "itemurl",
        "get",
        "console",
        "log",
        "itemid",
        "split",
        "itemurlrewrite",
        "replace",
        "findOne",
        "urlrewrite",
        "category",
        "ids",
        "categories",
        "think",
        "isEmpty",
        "map",
        "item",
        "show",
        "pagenumber",
        "pagesize",
        "getPageSelect",
        "itemList",
        "getPageCountSelect",
        "result",
        "Page",
        "adapter",
        "page",
        "http",
        "pageData",
        "pagination",
        "getuserAction",
        "post",
        "name",
        "user",
        "success",
        "itemAction",
        "topicurl",
        "tid",
        "topic_item",
        "topicInfo",
        "session",
        "uinfo",
        "islogin",
        "loginuserinfo",
        "aid",
        "type",
        "author",
        "iscollect",
        "collectList",
        "getReplyListInfo",
        "replyList",
        "where",
        "increment",
        "viewcount",
        "acc",
        "replycount",
        "editAction",
        "replyInfo"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\topic\\controller\\index.js",
    "sourcesContent": [
        "'use strict';\r\n\r\nimport Base from './base.js';\r\n\r\nexport default class extends Base {\r\n  /**\r\n   * index action\r\n   * @return {Promise} []\r\n   */\r\n  async indexAction(){\r\n    var lstparentmenu=await this.model(\"topic\").findAll('item',{parentid:['IN', [0]]});\r\n    var navList={menu:[]};\r\n    for (var i = 0; i < lstparentmenu.length; i++) {\r\n      var submenu=await this.model(\"topic\").findAll('item',{parentid:['IN', [parseInt(lstparentmenu[i].id)]]});\r\n      var submenusid=[];\r\n      for (var j = 0; j < submenu.length; j++) {\r\n        submenusid.push(submenu[j].id);\r\n      }\r\n      navList.menu.push({parentmenu:JSON.parse(JSON.stringify(lstparentmenu[i])),submenus:JSON.parse(JSON.stringify(submenu)),submenusid:submenusid});\r\n    }\r\n    //let navList = await this.model(\"home\").findAll('item',{parentid:['IN', [0]]});\r\n    this.assign(\"navList\", navList);\r\n       return this.displayView(\"index_index\");\r\n  }\r\n  async categoryAction()\r\n  {\r\n    let itemurl=this.get(\"url\");\r\n    console.log(itemurl)\r\n    var itemid=itemurl.split('-')[itemurl.split('-').length-1];\r\n    var itemurlrewrite=itemurl.replace(\"-\"+itemid,\"\");\r\n    var category=await this.model(\"topic\").findOne(\"item\",{id:itemid,urlrewrite:itemurlrewrite});\r\n    var ids=[category.id];\r\n    var categories=await this.model(\"topic\").findAll(\"item\",{parentid:itemid});\r\n    for(var i=0;i<categories.length;i++)\r\n    {\r\n      ids.push(categories[i].id);\r\n    }\r\n    if(!think.isEmpty(category))\r\n    {\r\n    this.assign(\"title\",\"Danh sách chủ đề\");\r\n    let map={item:ids,show:1}\r\n   //  let topicList=await this.model('topic').getTopicListJoinRecord(map);\r\n     let pagenumber=this.get(\"page\")||1;\r\n     let pagesize=this.get(\"pagesize\")||20;\r\n    //分页\r\n     let itemList=await this.model(\"topic\").getPageSelect(map,pagenumber,pagesize);\r\n     let result = await this.model(\"topic\").getPageCountSelect(map,pagenumber,pagesize);\r\n     var Page=think.adapter(\"template\", \"page\");\r\n     var page = new Page(this.http);\r\n     var pageData=page.pagination(result);\r\n\r\n     this.assign(\"itemList\",itemList);\r\n     this.assign('pageData',pageData);\r\n     this.assign('category',category);\r\n     this.assign('menu', \"chu-de/\"+category.urlrewrite+'-'+ category.id);\r\n    return this.displayView(\"category_index\");\r\n  }else {\r\n    return this.displayView(\"../common/error_404\");\r\n  }\r\n  }\r\n  async getuserAction(){\r\n       let name=await this.post(\"name\");\r\n       console.log(name)\r\n       var user=await this.model('topic').findAll('user',{name:name});\r\n       if(!think.isEmpty(user))\r\n       {\r\n         return this.success(JSON.parse(JSON.stringify(user)));\r\n       }\r\n       else {\r\n         return this.success();\r\n       }\r\n  }\r\n  async itemAction(){\r\n    let itemurl= await this.get(\"itemurl\");\r\n    let topicurl=await this.get(\"topicurl\");\r\n    console.log(itemurl);\r\n    console.log(topicurl);\r\n    var itemid=itemurl.split('-')[itemurl.split('-').length-1];\r\n    var itemurlrewrite=itemurl.replace(\"-\"+itemid,\"\");\r\n    var tid=topicurl.split('-')[topicurl.split('-').length-1];\r\n    var urlrewrite=topicurl.replace(\"-\"+tid,\"\");\r\n    var topic_item=await this.model('topic').findOne('item',{urlrewrite:itemurlrewrite,id:itemid});\r\n    if(!think.isEmpty(topic_item))\r\n    {\r\n      let topicInfo=await this.model(\"topic\").findOne(\"topic\",{urlrewrite:urlrewrite,id:tid});\r\n      if(!think.isEmpty(topicInfo)){\r\n    let uinfo=await this.session('uInfo');\r\n    let islogin=(!think.isEmpty(uinfo))?1:0;\r\n    this.assign(\"islogin\",islogin);\r\n    if(!think.isEmpty(uinfo)){\r\n      let loginuserinfo=await this.model('topic').findAll('user',{name:uinfo.name});\r\n      this.assign(\"loginuserinfo\",loginuserinfo[0]);\r\n      //获取收藏信息\r\n      let collectList=await this.model('topic').findAll('user_collect',{aid:tid,type:'topic',author:uinfo.name,iscollect:1});\r\n      if(collectList.length>0){\r\n        this.assign(\"cid\",collectList[0].id);\r\n        this.assign(\"iscollect\",1);\r\n      }else {\r\n        this.assign(\"cid\",\"\");\r\n        this.assign(\"iscollect\",0);\r\n      }\r\n    }else{\r\n      this.assign(\"loginuserinfo\",{});\r\n    }\r\n\r\n    // 获取回复列表\r\n    let replyList=await this.model(\"topic\").getReplyListInfo({tid:tid});\r\n    this.assign(\"replyList\",replyList);\r\n      let viewcount=await this.model(\"topic\").where({id:tid}).increment('view',1);\r\n      let acc=this.model('topic').findOne('user',{name:topicInfo.author});\r\n      console.log(acc)\r\n      if(!think.isEmpty(acc))\r\n      {\r\n        this.assign('acc',acc);\r\n      }\r\n      this.assign('topicInfo',topicInfo);\r\n      this.assign(\"replycount\",topicInfo.replycount);\r\n      return this.displayView(\"index_item\");\r\n    }else {\r\n      return this.displayView(\"../common/error_404\");\r\n    }\r\n  }else{\r\n      return this.displayView(\"../common/error_404\");\r\n    }\r\n  }\r\n\r\n  async editAction(){\r\n    let tid= await this.get(\"tid\");\r\n    let replyInfo=await this.model(\"topic\").findOne(\"topic_comment\",{id:tid});\r\n    let topicInfo=await this.model(\"topic\").findOne(\"topic\",{id:replyInfo.tid});\r\n    this.assign(\"title\",\"回复编辑\");\r\n    this.assign(\"replyInfo\",replyInfo);\r\n    this.assign(\"topicInfo\",topicInfo);\r\n    return this.displayView(\"index_edit\");\r\n  }\r\n}\r\n"
    ]
}