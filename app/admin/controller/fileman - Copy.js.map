{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\fileman - Copy.js"
    ],
    "names": [
        "express",
        "require",
        "router",
        "Router",
        "fs",
        "path",
        "sizeOf",
        "gm",
        "multer",
        "archiver",
        "serverRoot",
        "post",
        "req",
        "res",
        "response",
        "filesRoot",
        "getDirectories",
        "send",
        "pathDir",
        "body",
        "d",
        "readdirSync",
        "map",
        "file",
        "fileDir",
        "join",
        "info",
        "statSync",
        "isFile",
        "size",
        "err",
        "push",
        "p",
        "replace",
        "s",
        "t",
        "mtime",
        "getTime",
        "toFixed",
        "w",
        "width",
        "h",
        "height",
        "copySync",
        "f",
        "n",
        "msg",
        "mkdirsSync",
        "removeSync",
        "get",
        "download",
        "query",
        "setHeader",
        "basename",
        "archive",
        "pipe",
        "bulk",
        "expand",
        "cwd",
        "src",
        "finalize",
        "move",
        "dirname",
        "renameSync",
        "resize",
        "gravity",
        "crop",
        "stream",
        "storage",
        "diskStorage",
        "destination",
        "cb",
        "filename",
        "originalname",
        "upload",
        "array",
        "srcpath",
        "isDirectory",
        "module",
        "exports"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\fileman - Copy.js",
    "sourcesContent": [
        "var express = require('express');\nvar router = express.Router();\nvar fs = require('fs-extra');\nvar path = require('path');\nvar sizeOf = require('image-size');\nvar gm = require('gm');\nvar multer  = require('multer');\nvar archiver = require('archiver');\n\nvar serverRoot = './static/filemanager/';\n\n/* List directory tree */\nrouter.post('/dirlist', function(req, res) {\n  \n  var response = [];  \n  var filesRoot = 'Uploads';\n  \n  getDirectories(filesRoot, response);\n  \n  res.send(response);\n});\n\n/* List files in a directory */\nrouter.post('/fileslist', function(req, res) {\n  \n  var response = [];\n  var pathDir = serverRoot + req.body.d;\n  fs.readdirSync(pathDir).map(function(file) {\n    var fileDir = path.join(pathDir, file);\n    var info = fs.statSync(fileDir); \n    if(info.isFile()){\n        var size = null;\n        try { size = sizeOf(fileDir); } catch(err) { size = {}; }\n        response.push({ \n            p: path.join(req.body.d, file).replace(/\\\\/g, '/'), \n            s: info.size,\n            t: (info.mtime.getTime() / 1000).toFixed(0),\n            w: size.width,\n            h: size.height\n        });\n    }\n  });\n  \n  res.send(response);\n});\n\n/* Copying a file or directory */\nrouter.post('/copy', function(req, res) {\n  \n  try {\n    fs.copySync(path.join(serverRoot, req.body.f || req.body.d), path.join(serverRoot, req.body.n));\n    res.send({ res: \"ok\", msg: \"Success\" });\n  } catch (err) {\n    res.send({ res:\"error\", msg: err });\n  }\n});\n\n/* Create directory */\nrouter.post('/createdir', function(req, res) {\n  try {\n    fs.mkdirsSync(path.join(serverRoot, req.body.d, req.body.n));\n    res.send({ res: \"ok\", msg: \"Success\" });\n  } catch (err) {\n    res.send({ res:\"error\", msg: err });\n  }\n});\n\n/* Delete a file or directory */\nrouter.post('/delete', function(req, res) {\n  try {\n    fs.removeSync(path.join(serverRoot, req.body.f || req.body.d));\n    res.send({ res: \"ok\", msg: \"Success\" });\n  } catch (err) {\n    res.send({ res:\"error\", msg: err });\n  }\n});\n\n/* Download file */\nrouter.get('/download', function(req, res) {\n  \n  res.download(path.join(serverRoot, req.query.f));\n});\n\n/* Download directory */\nrouter.get('/downloaddir', function(req, res) {\n    \n  res.setHeader('Content-disposition', 'attachment; filename=' + path.basename(req.query.d) + '.zip');\n  \n  var archive = archiver('zip');\n  archive.pipe(res);\n  archive.bulk([\n    { expand: true, cwd: path.join(serverRoot, req.query.d), src: ['**/*'] }\n  ]);\n  archive.finalize();\n});\n\n/* Move a file or directory */\nrouter.post('/move', function(req, res) {\n  \n  fs.move(path.join(serverRoot, req.body.f || req.body.d), path.join(serverRoot, req.body.n), function (err) {\n    if (err) {\n        res.send({ res:\"error\", msg: err });\n    }\n    else{\n        res.send({ res: \"ok\", msg: \"Success\" });\n    }\n  });\n});\n\n/* Rename a file or directory */\nrouter.post('/rename', function(req, res) {\n  var pathDir = path.dirname(req.body.f || req.body.d);\n  try {\n    fs.renameSync(path.join(serverRoot, req.body.f || req.body.d), path.join(serverRoot, pathDir, req.body.n));\n    res.send({ res: \"ok\", msg: \"Success\" });\n  } catch (err) {\n    res.send({ res:\"error\", msg: err });\n  }\n});\n\n/* Generate thumbnail */\nrouter.get('/generatethumb', function(req, res) {\n  \n  res.setHeader(\"content-type\", \"image/png\");\n  \n  gm(path.join(serverRoot, req.query.f))\n  .resize(req.query.width || '200', req.query.height || '200', '^')\n  .gravity('Center')\n  .crop(req.query.width || '200', req.query.height || '200')\n  .stream('png')\n  .pipe(res);  \n  \n});\n\n/* Upload files */\nvar storage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, path.join(serverRoot, req.body.d));\n  },\n  filename: function (req, file, cb) {\n    cb(null, file.originalname);\n  }\n});\n\nvar upload = multer({ storage: storage }).array('files[]');\nrouter.post('/upload', function(req, res) {\n  upload(req, res, function (err) {\n    if (err) {\n      res.send({ res:\"error\", msg: err });\n    }\n    else{\n      res.send({ res: \"ok\", msg: \"Success\" });  \n    }\n  })  \n});\n\nvar getDirectories = function(srcpath, response) {\n  \n  var info = {\n    p: srcpath.replace(/\\\\/g, '/'),\n    f: 0,\n    d: 0\n  };\n  response.push(info);\n  \n  fs.readdirSync(serverRoot + srcpath).map(function(file) {\n    var pathDir = path.join(srcpath, file);\n    if(fs.statSync(serverRoot + pathDir).isDirectory()){\n        info.d++;\n        getDirectories(pathDir, response);\n    }else{\n        info.f++;\n    }\n  });\n};\n\nmodule.exports = router;"
    ]
}