{"version":3,"sources":["../../src/middleware/check_resource.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;AAEA;;;;AAEA;;;;;;;;;;;;;AAME;;;;mBAIA,G,kBAAK;AACH,QAAI,WAAW,KAAK,IAAL,CAAU,QAAzB;AACA,QAAI,CAAC,KAAK,MAAL,CAAY,aAAZ,CAAD,IAA+B,CAAC,QAAhC,IAA4C,aAAa,GAA7D,EAAkE;AAChE,aAAO,IAAP;AACD;AACD,eAAW,mBAAmB,QAAnB,EAA6B,OAA7B,CAAqC,KAArC,EAA4C,GAA5C,CAAX;AACA,eAAW,qBAAU,QAAV,CAAX;AACA;AACA,eAAW,SAAS,OAAT,CAAiB,KAAjB,EAAwB,GAAxB,CAAX;AACA,QAAI,MAAM,KAAK,MAAL,CAAY,cAAZ,CAAV;AACA,QAAI,CAAC,IAAI,IAAJ,CAAS,QAAT,CAAL,EAAyB;AACvB,aAAO,IAAP;AACD;AACD,QAAI,OAAO,qBAAa,MAAM,aAAnB,SAAoC,QAApC,CAAX;AACA,QAAG,KAAK,OAAL,CAAa,MAAM,aAAnB,MAAsC,CAAzC,EAA2C;AACzC,aAAO,IAAP;AACD;AACD;AACA,QAAI,MAAM,MAAN,CAAa,IAAb,CAAJ,EAAwB;AACtB,aAAO,IAAP;AACD,KAFD,MAEK;AACH,aAAO,IAAP;AACD;AACF,G;;;EA5B0B,MAAM,UAAN,CAAiB,I","file":"check_resource.js","sourcesContent":["'use strict';\n\nimport { normalize } from 'path';\n\n/**\n * resource check\n * @param  {}            \n * @return {}     []\n */\nexport default class extends think.middleware.base {\n  /**\n   * run\n   * @return {Promise} []\n   */\n  run(){\n    let pathname = this.http.pathname;\n    if (!this.config('resource_on') || !pathname || pathname === '/') {\n      return null;\n    }\n    pathname = decodeURIComponent(pathname).replace(/\\\\/g, '/');\n    pathname = normalize(pathname);\n    // replace \\ to / on windows\n    pathname = pathname.replace(/\\\\/g, '/');\n    let reg = this.config('resource_reg');\n    if (!reg.test(pathname)) {\n      return null;\n    }\n    let file = normalize(`${think.RESOURCE_PATH}/${pathname}`);\n    if(file.indexOf(think.RESOURCE_PATH) !== 0){\n      return null;\n    }\n    //resource exist\n    if (think.isFile(file)) {\n      return file;\n    }else{\n      return true;\n    }\n  }\n}"]}